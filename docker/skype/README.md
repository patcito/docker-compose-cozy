Documentation
=============

This docker is about using a Skype instance which will run inside a
Docker container.  The configuration of sound and video will be taken care of.

Build the image
---------------

In order to use this Skype image, you have to build it from the `Dockerfile`.
To build it, you can use the following command.

```
docker build --tag=skype - < /path/to/Dockerfile
```

You can alternatively build it from the folder that contains the `Dockerfile`
with the following command.

```
docker build --tag=skype .
```

Run the container
-----------------

Now, you can run the container with the following command.

```
docker run \
	--name=skype \
	--rm \
	--env=DISPLAY=unix$DISPLAY \
	--env=LD_PRELOAD=/usr/lib/i386-linux-gnu/libv4l/v4l1compat.so \
	--device=/dev/video0 \
	--volume=/tmp/.X11-unix:/tmp/.X11-unix:ro \
	--volume=/run/user/${UID}/pulse:/run/pulse:ro \
	skype \
	/usr/bin/skype
```

Here is a few explanations about each of the options:
* `--name=skype` gives a name to the running container
* `--rm` removes the container when exits
* `--env=DISPLAY=unix$DISPLAY` define the [target
  screen](https://stackoverflow.com/questions/25281992/alternatives-to-ssh-x11-forwarding-for-docker-containers/25334301#25334301)
  for displaying on X11 with a little
  [fix](http://golangcloud.blogspot.de/2014/06/run-x11-application-inside-docker.html)
* `--env=LD_PRELOAD=/usr/lib/i386-linux-gnu/libv4l/v4l1compat.so` in order to
  [explicitly load the i386 webcam's
  libraries](https://wiki.debian.org/skype#Frequently_Ask_Questions_.28F.A.Q..29_for_64_bits)
* `--device=/dev/video0` to allow the video device in the container
* `--volume=/tmp/.X11-unix:/tmp/.X11-unix:ro` will bind X11 facilities between
  host and container
* `--volume=/run/user/${UID}/pulse:/run/pulse:ro` will [bind Pulseaudio
  socket](https://github.com/terlar/docker-spotify-pulseaudio) between host and
  container
* `skype` is the name of the image to run
* `/usr/bin/skype` is the command to launch on the container

Concept of data container
-------------------------

In order to save data and configuration generated by Skype, the folder
`/home/skype/.Skype` must be saved.  The persistence of data is done through the
`VOLUME /home/skype` line in the `Dockerfile`.  However, we can now rely on the
concept of [data containers](https://docs.docker.com/userguide/dockervolumes/).
The basic idea is that if you want to update your software, you'll just throw
the container and create a new one with a new version of the software.  However,
this delete the links with the volume (which do the persistence of data).  One
solution is to create a container specifically for the data; and then create a
second container that will use this first container as a volume (see [this
post](https://stackoverflow.com/questions/18496940/how-to-deal-with-persistent-storage-e-g-databases-in-docker/20652410#20652410)
for more details).

To run the data container of Skype, do as following.

```
docker run \
	--name=skype-data \
	skype \
	true
```

With `--name=skype-data` for naming the container; `skype` in order to use the
same image for [data persistence
](http://container42.com/2014/11/18/data-only-container-madness/); and `true`
the command to send to the container (which basically do nothing).

Then now, you can run the skype container with a very similar command than the
one we already saw in previous section.

```
docker run \
	--name=skype \
	--rm \
	--volumes-from=skype-data \
	--env=DISPLAY=unix$DISPLAY \
	--env=LD_PRELOAD=/usr/lib/i386-linux-gnu/libv4l/v4l1compat.so \
	--device=/dev/video0 \
	--volume=/tmp/.X11-unix:/tmp/.X11-unix:ro \
	--volume=/run/user/${UID}/pulse:/run/pulse:ro \
	skype \
	/usr/bin/skype
```

Note the `--volumes-from=skype-data` that has been added and will bind volumes
from the container `skype-data` into the new `skype` container.

On GNOME
--------
If you want this Skype container instance to be launched as a normal GNOME
application, take a look into the `usr/` folder and copy or make symbolic links
to all of these files.
